# [11-8] E2E CoS Test for PBI 11

[Back to task list](./tasks.md)

## Description
Create comprehensive end-to-end tests that validate all Conditions of Satisfaction for PBI 11 (Docker Image Service Deployment), ensuring the complete workflow works from UI to Railway deployment.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-09-30 14:30:00 | Created | N/A | Proposed | Task file created | ai-agent |

## Requirements
Test all acceptance criteria from PBI 11:
1. Users can select "Docker Image" as deployment source in wizard
2. Services can be created from Docker Hub public images
3. Services can be created from GHCR public images
4. Image reference validation prevents invalid formats
5. Custom registry URLs are supported
6. Port configuration works for image-based services
7. Environment variables can be set for image-based services
8. Service cards display deployment type
9. Image accessibility is validated before deployment attempt
10. Error messages clearly indicate image-related issues

## Implementation Plan

### Test Environment Setup
- Test Railway project for deployment testing
- Test Docker images (public) for validation
- Test database with clean state

### E2E Test Scenarios

**Test 1: Deploy from Docker Hub public image**
- Navigate to environment creation wizard
- Select "Docker Image" deployment source
- Select "Docker Hub" registry
- Enter valid image (e.g., `nginx:latest`)
- Configure port 80
- Add environment variable
- Complete wizard
- Verify service created in Railway
- Verify service appears with correct metadata
- Verify deployment type badge shows "Image"

**Test 2: Deploy from GHCR public image**
- Select GHCR as registry
- Enter valid GHCR image reference
- Complete deployment
- Verify successful creation

**Test 3: Invalid image reference**
- Enter malformed image reference
- Verify validation error displays
- Verify user cannot proceed
- Error message is clear and actionable

**Test 4: Custom registry**
- Select "Custom" registry
- Enter custom registry URL
- Complete deployment
- Verify service created with custom registry

**Test 5: Port configuration**
- Add multiple ports (80, 443)
- Verify ports are configured correctly
- Verify Railway service has correct port mapping

**Test 6: Environment variables**
- Add multiple environment variables
- Verify variables are set on created service
- Verify variables appear in Railway

**Test 7: Service card display**
- After creating image-based service
- Verify deployment type badge shows "Image"
- Verify image reference is displayed
- Verify registry icon appears

**Test 8: Non-existent image**
- Enter valid format but non-existent image
- Attempt deployment
- Verify error message indicates image not found
- Verify partial deployment is cleaned up

**Test 9: Mixed deployment (source + image)**
- Create environment with both source-based and image-based services
- Verify both types work correctly
- Verify UI displays both types correctly

**Test 10: Error handling**
- Test various failure scenarios:
  - Railway API timeout
  - Invalid credentials (if applicable)
  - Network errors
- Verify error messages are user-friendly
- Verify retry mechanisms work

## Test Plan

### Success Criteria
- All 10 test scenarios pass
- Docker Hub deployment works end-to-end
- GHCR deployment works end-to-end
- Validation prevents invalid inputs
- Error handling provides clear feedback
- Service metadata is correctly stored
- UI displays deployment type correctly

### Test Execution
- Manual testing for initial validation
- Automated E2E tests (if testing framework exists)
- Document any failures or edge cases
- Verify on both local and deployed environments

## Verification
- All acceptance criteria from PBI 11 are validated
- Test results are documented
- Any issues found are logged as bugs or follow-up tasks
- Success cases have screenshots or recordings
- Error cases have documented resolution steps

## Files Modified
- `test/e2e/pbi-11-docker-image-deployment.test.ts` (if automated)
- `docs/delivery/11/test-results.md` (test execution results)

