# [11-3] Implement Railway client support for image-based service creation

[Back to task list](./tasks.md)

## Description
Extend the Railway GraphQL client to support creating services from Docker images by implementing the necessary mutations and request/response handling for image-based deployments.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-09-30 14:30:00 | Created | N/A | Proposed | Task file created | ai-agent |
| 2025-09-30 16:20:00 | Status Change | Proposed | Agreed | Task approved to implement Railway client support | sean |
| 2025-09-30 16:21:00 | Status Change | Agreed | InProgress | Starting Railway client extension for image deployments | ai-agent |
| 2025-09-30 16:45:00 | Status Change | InProgress | Review | Extended CreateServiceInput, added image deployment mutations, comprehensive tests pass | ai-agent |
| 2025-09-30 17:15:00 | Status Change | Review | Done | Task approved, Railway client supports both repo and image deployments with conditional input building | sean |

## Requirements
- Extend `CreateServiceInput` to support image source configuration
- Add new input fields for Docker image deployments:
  - `ImageSource`: struct with registry, image, tag/digest
  - `ImageAuthConfig`: optional authentication configuration
- Implement GraphQL mutation for image-based service creation
- Handle both source repo and image-based creation in unified interface
- Support public and private registry authentication
- Add error handling for image-specific failures (image not found, auth failed)
- Follow existing Railway client patterns and conventions

## Implementation Plan
1. Review task 11-1 guide for exact mutation signatures
2. Extend `CreateServiceInput` struct in `api/internal/railway/types.go`
3. Add `ImageSource` type with registry, image, tag fields
4. Update `CreateService` method to handle both source types
5. Construct appropriate GraphQL variables based on input type
6. Test with Docker Hub public images
7. Test with GHCR public images
8. Document image-specific error codes and handling
9. Add retry logic for transient registry errors

## Test Plan
### Basic Implementation Scope
- Client can create service from Docker Hub public image
- Client can create service from GHCR public image
- Error handling for invalid image references
- Error handling for non-existent images
- Successful service creation returns Railway service ID
- Client follows existing patterns for error classification

## Verification
- `CreateServiceInput` supports both repo and image sources
- GraphQL mutation executes successfully for image-based services
- Service is created in Railway with correct image reference
- Error messages are clear and actionable
- Code follows existing Railway client patterns
- Unit tests pass for new functionality

## Files Modified
- `api/internal/railway/types.go` (input types)
- `api/internal/railway/service.go` (CreateService method)
- `api/internal/railway/client.go` (if mutation needs to be added)

