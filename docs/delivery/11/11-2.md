# [11-2] Extend data model for Docker image service metadata

[Back to task list](./tasks.md)

## Description
Extend the `Service` model in the database schema to support Docker image-based deployments by adding fields for deployment type, image configuration, and registry information.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-09-30 14:30:00 | Created | N/A | Proposed | Task file created | ai-agent |

## Requirements
- Add `DeploymentType` field to Service model (enum: "source_repo", "docker_image")
- Add Docker image configuration fields:
  - `DockerImage`: full image reference
  - `ImageRegistry`: registry URL (docker.io, ghcr.io, custom)
  - `ImageName`: image name without tag
  - `ImageTag`: tag or digest
  - `ImageAuthRequired`: boolean flag for private images
- Fields should be nullable to maintain backward compatibility with existing services
- Create database migration for schema changes
- Update GORM model definitions
- Ensure indexes are appropriate for new fields

## Implementation Plan
1. Define new constants for `DeploymentType` enum
2. Add new fields to `Service` struct in `api/internal/store/models.go`
3. Create GORM migration file for schema changes
4. Add validation for new fields (e.g., image reference format)
5. Update any existing queries to handle nullable fields
6. Test migration on clean database
7. Test migration on database with existing data

## Test Plan
### Simple Task Scope
- Migration runs successfully on clean database
- Migration runs successfully on database with existing services
- Service model can be created with `DeploymentType = "source_repo"` (existing behavior)
- Service model can be created with `DeploymentType = "docker_image"` and image fields
- Nullable fields are handled correctly for existing services
- Database constraints are enforced (e.g., non-null deployment type)

## Verification
- Schema migration file exists and applies cleanly
- `Service` struct has all new fields with proper tags
- Constants defined for deployment types
- Existing services continue to work after migration
- New image-based services can be stored and retrieved
- No breaking changes to existing code

## Files Modified
- `api/internal/store/models.go` (Service struct)
- `api/internal/store/migrations/` (new migration file)
- `api/internal/store/constants.go` (if exists, or create for DeploymentType enum)

