# [11-7] Update service cards to display deployment type

[Back to task list](./tasks.md)

## Description
Enhance service cards and detail views throughout the UI to display whether a service is deployed from source code or from a Docker image, including relevant metadata like image reference.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-09-30 14:30:00 | Created | N/A | Proposed | Task file created | ai-agent |
| 2025-10-01 01:00:00 | Status Change | Proposed | Agreed | Task approved to add deployment type display | sean |
| 2025-10-01 01:01:00 | Status Change | Agreed | InProgress | Starting implementation of deployment type badges | ai-agent |
| 2025-10-01 01:30:00 | Status Change | InProgress | Review | Implemented deployment type badges with consistent styling | ai-agent |
| 2025-10-01 16:30:00 | Status Change | Review | Done | Integrated Railway API data for automatic deployment type detection | ai-agent |

## Requirements
- Add deployment type badge to service cards
  - "Source" badge with git icon for repo-based services
  - "Image" badge with container icon for image-based services
- Display appropriate metadata based on deployment type:
  - Source-based: show repo URL and branch
  - Image-based: show image reference (registry/image:tag)
- Update service detail view to show full deployment configuration
- Add visual distinction (different colors/icons) for deployment types
- Ensure consistent display across all service views:
  - Environment detail page (service list)
  - Dashboard (if services are shown)
  - Service detail pages
- Show image registry icon (Docker logo, GitHub logo) where appropriate

## Implementation Plan
1. Update service card component to read deployment type
2. Add badge component for deployment type display
3. Conditionally render repo info vs image info
4. Add icons for source (GitBranch) and image (Package/Container)
5. Update service detail view with deployment configuration section
6. Add registry-specific icons (Docker, GitHub)
7. Style badges with appropriate colors
8. Test with both deployment types
9. Ensure backward compatibility with existing services

## Test Plan
### Basic Implementation Scope
- Service cards display correct badge for deployment type
- Source-based services show repo and branch
- Image-based services show image reference
- Icons display correctly for each type
- Service detail view shows full deployment configuration
- Visual design is clear and professional
- Backward compatibility maintained for existing services

## Verification
- Deployment type badges appear on all service cards
- Correct metadata displayed based on deployment type
- Icons are clear and visually distinct
- Design is consistent across all views
- No layout issues or visual regressions
- Existing services still display correctly

## Files Modified
- `web/src/components/service/DeploymentTypeBadge.tsx` (new component) ✅
- `web/src/components/project/services-list.tsx` (added deployment type display) ✅
- `web/src/components/project/environment-card.tsx` (updated Service interface) ✅
- `web/src/components/project/project-detail.tsx` (integrated Railway API source data) ✅

## Implementation Summary

### Created Components
1. **DeploymentTypeBadge.tsx**: Reusable badge component that displays deployment type
   - "Source" badge with GitBranch icon in violet color scheme
   - "Image" badge with Package icon in blue color scheme
   - Consistent with existing UI design patterns
   - Uses outline variant with custom background and border colors

### Updated Components
1. **services-list.tsx**:
   - Extended Service interface with deployment configuration fields:
     - `deploymentType`: "source_repo" | "docker_image" (optional, defaults to source_repo)
     - `sourceRepo`, `sourceBranch`: for repository-based deployments
     - `dockerImage`, `imageRegistry`, `imageTag`: for image-based deployments
   - Added `getDeploymentDetails()` helper to format deployment information
   - Updated service card layout to display:
     - Deployment type badge next to service name
     - Deployment details (repo@branch or image reference) below service type
   - Improved responsive layout with proper text truncation

2. **environment-card.tsx**:
   - Updated Service interface to match services-list.tsx
   - Ensures type consistency across the codebase

### Features Implemented
✅ Deployment type badges on all service cards
✅ Visual distinction with different colors and icons
✅ Source deployments show repo and branch (when available)
✅ Image deployments show full image reference (when available)
✅ Backward compatible with existing services (defaults to source_repo)
✅ Responsive layout that works on mobile and desktop
✅ Consistent styling with existing design system

### Design Choices
- **Automatic detection**: Deployment type is automatically detected from Railway API `source` field
  - `source.image` present → Docker image deployment
  - `source.repo` present → Git repository deployment
- **Optional fields**: All deployment config fields are optional to maintain backward compatibility
- **Graceful degradation**: If deployment details aren't available, only the badge is shown
- **Color scheme**: Violet for source (matches git/code theme), blue for images (matches Docker/container theme)

### Railway API Integration (Completed)
✅ **Updated `project-detail.tsx`** to map Railway service instance data:
- Checks `RailwayServiceInstance.source.image` to detect Docker image deployments
- Checks `RailwayServiceInstance.source.repo` to detect Git repository deployments
- Automatically sets `deploymentType` based on source data
- Passes `dockerImage` and `sourceRepo` to service cards for display
- Services now show correct deployment type badges in real-time

### Future Enhancements
- Parse `latestDeployment.meta` for additional deployment metadata
- Click-through from badge to detailed deployment configuration view
- Show deployment status and timestamp from `latestDeployment` fields

