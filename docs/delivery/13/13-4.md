# [13-4] Remove unused CRUD endpoints and clean up dead code

[Back to task list](./tasks.md)

## Description

Remove the old Environment CRUD endpoints that are not used by the wizard and clean up related dead code. These routes (`POST /environments`, `GET /environments`, `GET /environments/:id`, `DELETE /environments/:id`) were from an earlier iteration and are now superseded by the `/provision/*` endpoints.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-03 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |

## Requirements

1. Remove unused HTTP handlers from EnvironmentController:
   - `CreateEnvironment` (not used by wizard)
   - `ListEnvironments` (not used by UI)
   - `GetEnvironment` (not used by UI)
   - `DestroyEnvironment` (use Railway direct delete instead)
2. Remove corresponding route registrations
3. Keep the Railway proxy endpoints (still used)
4. Keep provision endpoints (actively used by wizard)
5. Remove unused frontend API client code if any
6. Update any tests that reference removed endpoints

## Implementation Plan

1. In `api/internal/controller/environment.go`:
   - Delete `CreateEnvironment` function
   - Delete `ListEnvironments` function
   - Delete `GetEnvironment` function
   - Delete `DestroyEnvironment` function
   - Delete related request/response structs: `createEnvRequest`, `envResponse`
   - Keep: Railway proxy methods, Provision methods
2. Update `RegisterRoutes`:
   - Remove: `GET /environments`, `POST /environments`, `GET /environments/:id`, `DELETE /environments/:id`
   - Keep: Railway proxy routes, provision routes
3. In `web/src/lib/api/environments.ts`:
   - Remove or comment out `listEnvironments` and `destroyEnvironment`
   - Mark file for potential deletion if nothing else uses it
4. In `web/src/hooks/useEnvironments.ts`:
   - Keep mock data for now (used for UI development)
   - Remove actual API calls or mark as TODO
5. Clean up any tests that reference removed endpoints

## Verification

- Removed functions are completely deleted
- Routes are unregistered
- No compilation errors
- Wizard flow still works (uses different endpoints)
- No broken imports

## Test Plan

**Objective**: Verify unused endpoints are removed without breaking wizard

**Test Scope**: Code cleanup and regression testing

**Key Test Scenarios**:
1. Verify removed routes return 404
2. Wizard flow still works end-to-end
3. Railway proxy endpoints still work
4. Provision endpoints still work
5. No broken imports in frontend
6. Tests compile and run

**Success Criteria**:
- Code compiles successfully
- Removed endpoints no longer accessible
- Active wizard flow unaffected
- All tests pass
- No dead code warnings

## Files Modified

- `api/internal/controller/environment.go` - Remove unused handlers
- `web/src/lib/api/environments.ts` - Remove unused functions
- `web/src/hooks/useEnvironments.ts` - Update or mark TODO
- Test files - Remove tests for deleted endpoints
