# [13-4] Remove unused CRUD endpoints and clean up dead code

[Back to task list](./tasks.md)

## Description

Remove the old Environment CRUD endpoints that are not used by the wizard and clean up related dead code. These routes (`POST /environments`, `GET /environments`, `GET /environments/:id`, `DELETE /environments/:id`) were from an earlier iteration and are now superseded by the `/provision/*` endpoints.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-03 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2025-10-04 00:00:00 | Status Change | Proposed | InProgress | Started removing unused endpoints | AI Agent |
| 2025-10-04 00:00:00 | Status Change | InProgress | Review | All unused endpoints removed, code compiles successfully | AI Agent |
| 2025-10-04 00:00:00 | Status Change | Review | Done | Task approved and complete | sean |

## Requirements

1. Remove unused HTTP handlers from EnvironmentController:
   - `CreateEnvironment` (not used by wizard)
   - `ListEnvironments` (not used by UI)
   - `GetEnvironment` (not used by UI)
   - `DestroyEnvironment` (use Railway direct delete instead)
2. Remove corresponding route registrations
3. Keep the Railway proxy endpoints (still used)
4. Keep provision endpoints (actively used by wizard)
5. Remove unused frontend API client code if any
6. Update any tests that reference removed endpoints

## Implementation Plan

1. In `api/internal/controller/environment.go`:
   - Delete `CreateEnvironment` function
   - Delete `ListEnvironments` function
   - Delete `GetEnvironment` function
   - Delete `DestroyEnvironment` function
   - Delete related request/response structs: `createEnvRequest`, `envResponse`
   - Keep: Railway proxy methods, Provision methods
2. Update `RegisterRoutes`:
   - Remove: `GET /environments`, `POST /environments`, `GET /environments/:id`, `DELETE /environments/:id`
   - Keep: Railway proxy routes, provision routes
3. In `web/src/lib/api/environments.ts`:
   - Remove or comment out `listEnvironments` and `destroyEnvironment`
   - Mark file for potential deletion if nothing else uses it
4. In `web/src/hooks/useEnvironments.ts`:
   - Keep mock data for now (used for UI development)
   - Remove actual API calls or mark as TODO
5. Clean up any tests that reference removed endpoints

## Verification

- Removed functions are completely deleted
- Routes are unregistered
- No compilation errors
- Wizard flow still works (uses different endpoints)
- No broken imports

## Test Plan

**Objective**: Verify unused endpoints are removed without breaking wizard

**Test Scope**: Code cleanup and regression testing

**Key Test Scenarios**:
1. Verify removed routes return 404
2. Wizard flow still works end-to-end
3. Railway proxy endpoints still work
4. Provision endpoints still work
5. No broken imports in frontend
6. Tests compile and run

**Success Criteria**:
- Code compiles successfully
- Removed endpoints no longer accessible
- Active wizard flow unaffected
- All tests pass
- No dead code warnings

## Files Modified

- `api/internal/controller/environment.go` - Removed unused handlers and structs, cleaned up route registrations
- `web/src/lib/api/environments.ts` - Removed unused functions (kept type definitions)
- `web/src/hooks/useEnvironments.ts` - Removed unused hooks (kept MOCK_ENVIRONMENTS)
- No test files required changes (no tests referenced the removed endpoints)

## Implementation Summary

**Backend Changes (`api/internal/controller/environment.go`):**
- ✅ Deleted `CreateEnvironment()` handler (lines 68-114)
- ✅ Deleted `ListEnvironments()` handler (lines 55-66)
- ✅ Deleted `GetEnvironment()` handler (lines 116-124)
- ✅ Deleted `DestroyEnvironment()` handler (lines 126-145)
- ✅ Deleted `createEnvRequest` struct
- ✅ Deleted `envResponse` struct
- ✅ Updated `RegisterRoutes()` to remove 4 old CRUD routes:
  - Removed `GET /environments`
  - Removed `POST /environments`
  - Removed `GET /environments/:id`
  - Removed `DELETE /environments/:id`
- ✅ Kept all Railway proxy endpoints (ListRailwayProjects, GetRailwayProject, DeleteRailwayProject, DeleteRailwayEnvironment)
- ✅ Kept all provision endpoints (ProvisionProject, ProvisionEnvironment)

**Frontend Changes:**

**`web/src/lib/api/environments.ts`:**
- ✅ Removed `listEnvironments()` function
- ✅ Removed `destroyEnvironment()` function
- ✅ Removed unused `fetchJSON` import
- ✅ Kept all type definitions: `Environment`, `EnvironmentType`, `EnvironmentStatus`

**`web/src/hooks/useEnvironments.ts`:**
- ✅ Removed `useEnvironments()` hook
- ✅ Removed `useDestroyEnvironment()` hook
- ✅ Removed unused React Query imports
- ✅ Kept `MOCK_ENVIRONMENTS` array (used for UI development)
- ✅ Kept `Environment` type import

**Verification Results:**
- ✅ Backend compiles successfully (`go build ./...` - exit code 0)
- ✅ Frontend compiles successfully (`pnpm run build` - exit code 0)
- ✅ No linter errors in modified files
- ✅ No broken imports detected
- ✅ Wizard flow unaffected (uses `/provision/*` endpoints)
- ✅ Dashboard unaffected (uses `/railway/projects` proxy endpoint)
- ✅ Environment deletion unaffected (uses `/railway/environment/:id` proxy endpoint)

**Impact Analysis:**
- **No breaking changes** - All active features continue to work
- **Zero components** were using the removed hooks
- **Zero tests** were referencing the removed endpoints
- The wizard, dashboard, and all UI components use the Railway proxy endpoints and provision endpoints exclusively
