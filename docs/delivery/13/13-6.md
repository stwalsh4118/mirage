# [13-6] Build frontend metadata display components

[Back to task list](./tasks.md)

## Description

Create React components to display environment metadata and service build configurations in the UI. This provides visibility into how environments were created and serves as foundation for future cloning workflows (PBI 15).

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-03 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2025-10-04 00:00:00 | Status Change | Proposed | InProgress | Started implementing metadata display components | AI Agent |
| 2025-10-04 00:00:00 | Status Change | InProgress | Review | All components implemented and build successful | AI Agent |
| 2025-10-04 00:00:00 | Status Change | Review | Done | Task approved and complete, wizard metadata capture fixed | sean |

## Requirements

1. Create metadata display component for environment detail/project view
2. Show key information about how environment was created:
   - Source repository or docker image
   - Discovered services that were deployed
   - Configuration used (env vars, TTL, etc.)
3. Display service build configuration in service views
4. Add "Save as Template" button for future use
5. Handle missing metadata gracefully (old environments)
6. Keep UI simple and informative

## Implementation Plan

1. Create `EnvironmentMetadata.tsx` component:
   - Fetch metadata from API when viewing environment
   - Display wizard inputs in organized sections:
     - Source (repo URL/branch or image details)
     - Services deployed (names, Dockerfile paths)
     - Configuration (environment type, TTL)
   - Collapsible/expandable for space efficiency
   - Handle loading and error states
2. Create `ServiceBuildInfo.tsx` component:
   - Display service-specific build configuration
   - Show Dockerfile path, build context
   - List build arguments if present
   - Show exposed ports
   - Display image details for image-based services
3. Update project detail page or create environment detail page:
   - Add metadata display section
   - Show service list with build info
   - Add "Save as Template" button (non-functional for now, PBI 15)
4. Add API client functions in `web/src/lib/api/railway.ts`:
   - `getEnvironmentMetadata(envId: string)`
   - `getEnvironmentServices(envId: string)`
5. Create React hooks if needed for data fetching

## Verification

- Metadata component displays all captured wizard inputs
- Service build info shows complete configuration
- Missing metadata displays appropriate message
- UI is responsive and well-organized
- Loading and error states work correctly

## Test Plan

**Objective**: Verify metadata display components render correctly

**Test Scope**: Frontend component rendering

**Key Test Scenarios**:
1. Display environment metadata for repo-based environment
2. Display environment metadata for image-based environment
3. Show service build configuration with Dockerfile path
4. Show service configuration for image-based service
5. Handle environments without metadata gracefully
6. Loading states display correctly
7. Error states provide clear feedback

**Success Criteria**:
- All metadata fields display correctly
- UI is intuitive and readable
- Empty/missing states handled well
- Components are performant
- Responsive design works on different screen sizes

## Files Modified

- `web/src/components/environment/EnvironmentMetadata.tsx` - New component
- `web/src/components/environment/ServiceBuildInfo.tsx` - New component
- `web/src/components/project/project-detail.tsx` - Integrated metadata components
- `web/src/lib/api/railway.ts` - Added API client functions and TypeScript types
- `web/src/hooks/useRailway.ts` - Added new hooks for metadata and service fetching

## Implementation Summary

**API Client Enhancements (`web/src/lib/api/railway.ts`):**

Added comprehensive TypeScript types:
- `WizardInputs` - Captures all wizard input data (source type, repository/image details, discovered services, env type, TTL)
- `ProvisionOutputs` - Stores Railway IDs from provisioning (project, environment, service IDs)
- `EnvironmentMetadata` - Complete metadata record with wizard inputs and provision outputs
- `ServiceBuildConfig` - Detailed service build configuration including deployment type, source/image details, build args, and ports
- `TemplateListItem` - Template listing summary

Added API client functions:
- `getEnvironmentMetadata(environmentId)` - Retrieves environment metadata
- `getEnvironmentServices(environmentId)` - Retrieves all services for an environment
- `getServiceDetails(serviceId)` - Retrieves single service details
- `listTemplates()` - Lists all environment templates

**React Hooks (`web/src/hooks/useRailway.ts`):**

Added four new hooks using React Query:
- `useEnvironmentMetadata(environmentId, enabled)` - Fetches environment metadata with retry disabled for 404s
- `useEnvironmentServices(environmentId, enabled)` - Fetches service build configurations for an environment
- `useServiceDetails(serviceId, enabled)` - Fetches single service details
- `useTemplates()` - Fetches list of templates

All hooks properly handle null/undefined IDs and include proper enabled flags.

**EnvironmentMetadata Component:**

Created comprehensive metadata display component with:
- Loading skeleton state using shadcn Skeleton component
- Graceful error handling for missing metadata (404s)
- Collapsible accordion sections using shadcn Accordion:
  - **Source Configuration**: Displays repository URL/branch or Docker image/registry/tag with appropriate icons
  - **Discovered Services**: Shows all services discovered during wizard with paths and Dockerfile locations
  - **Environment Settings**: Displays environment type and TTL with Clock icon
  - **Provision Details**: Shows Railway project/environment/service IDs in monospace font
- Template badge display for template environments
- "Save as Template" button (placeholder for PBI 15)
- Timestamp display
- Consistent styling with glass morphism effects

**ServiceBuildInfo Component:**

Created flexible service build info display with:
- Two display modes: `compact` (inline) and full (card with accordion)
- Deployment type badge (Repository vs Docker Image)
- Collapsible accordion sections:
  - **Deployment Configuration**: Shows source repo/branch/Dockerfile or Docker image/registry/tag
  - **Build Arguments**: Displays all environment variables/build args as key-value pairs
  - **Exposed Ports**: Shows all exposed ports as badges
  - **Railway Details**: Displays Railway service ID
- Status badge display
- Proper icon usage (GitBranch, Box, FileCode, Network, etc.)
- Responsive layout with proper text truncation for long values
- Timestamp display

**Project Detail Page Integration:**

Enhanced `project-detail.tsx` to include metadata display:
- Added `useEnvironmentServices` hook to fetch service build configs for selected environment
- Added `EnvironmentMetadata` component display when environment is selected
- Added "Service Build Configurations" section showing all services in a responsive grid (1 column on mobile, 2 on tablet+)
- "Save as Template" button shows toast notification about PBI 15
- Components appear in logical order: metadata → services list → build configurations

**Styling Consistency:**

All components follow established patterns:
- Glass morphism with `glass grain` classes
- Hover effects with `transition-all duration-200 hover:translate-y-[-1px] hover:scale-[1.01]`
- Consistent color coding for badges and status indicators
- Proper spacing with shadcn Card, CardHeader, CardContent
- Responsive grid layouts
- Monospace font for code/IDs
- Muted foreground text for labels and secondary information
- Border styling with `border-border/50`

**Error Handling:**

- Loading states with skeleton placeholders
- 404 errors handled gracefully with informative messages
- Missing metadata displays user-friendly message
- Empty states handled (no build args, no ports, etc.)
- Retry disabled for metadata queries to avoid spamming backend

**Verification Results:**

- ✅ Frontend compiles successfully (`pnpm run build` - exit code 0)
- ✅ No linter errors in any modified files
- ✅ All TypeScript types properly defined
- ✅ All imports resolved correctly
- ✅ Skeleton component exists and imported correctly
- ✅ Components follow established UI patterns
- ✅ Responsive design implemented
- ✅ Error states handled appropriately

**Key Features:**

1. **Progressive Disclosure**: Uses accordions to keep UI clean while providing access to detailed information
2. **Visual Hierarchy**: Clear sections with icons, badges, and typography to guide the user
3. **Responsive Design**: Grid layouts adapt to screen size (mobile → tablet → desktop)
4. **Loading States**: Skeleton loaders prevent layout shift during data fetching
5. **Error Resilience**: Gracefully handles missing metadata (old environments) without breaking UI
6. **Accessibility**: Proper semantic HTML, keyboard navigation via accordions
7. **Future-Ready**: "Save as Template" button placeholder for PBI 15 implementation

**User Experience:**

- When user selects an environment, they immediately see how it was created
- Wizard inputs are preserved and visible for reference
- Service build configurations provide deep insight into deployment setup
- Collapsible sections prevent information overload
- Consistent styling maintains visual coherence with rest of application
