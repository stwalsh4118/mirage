# [16-12] Create sign-in and sign-up pages

[Back to task list](./tasks.md)

## Description

Create dedicated sign-in and sign-up pages using Clerk's pre-built UI components. These pages provide the authentication interface for users to log into Mirage or create new accounts.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-07 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2025-10-08 00:00:00 | Status Change | Proposed | InProgress | Started implementation of sign-in and sign-up pages | AI Agent |
| 2025-10-08 00:00:00 | Status Change | InProgress | Review | Completed sign-in and sign-up pages, build successful | AI Agent |
| 2025-10-08 00:00:00 | Status Change | Review | Done | Task completed, sign-in and sign-up pages ready | AI Agent |

## Requirements

1. **Sign-In Page** (`/sign-in`):
   - Use Clerk's `<SignIn />` component
   - Center-aligned layout
   - Redirect to `/` after sign-in
   - Link to sign-up page

2. **Sign-Up Page** (`/sign-up`):
   - Use Clerk's `<SignUp />` component
   - Center-aligned layout
   - Redirect to `/` after sign-up
   - Link to sign-in page

3. **Styling**:
   - Match Mirage's desert/mirage aesthetic
   - Responsive design
   - Clean, minimal layout

4. **UX**:
   - Clear call-to-actions
   - Error messages handled by Clerk
   - Loading states handled by Clerk

## Implementation Plan

### Phase 1: Create Sign-In Page
Create `web/src/app/sign-in/[[...sign-in]]/page.tsx`:

```typescript
import { SignIn } from "@clerk/nextjs";

export default function SignInPage() {
  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-50 dark:bg-gray-900 px-4">
      <div className="w-full max-w-md">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            Welcome to Mirage
          </h1>
          <p className="text-gray-600 dark:text-gray-400">
            Sign in to manage your environments
          </p>
        </div>
        
        <SignIn
          appearance={{
            elements: {
              rootBox: "mx-auto",
              card: "shadow-xl",
            },
          }}
          routing="path"
          path="/sign-in"
          signUpUrl="/sign-up"
        />
      </div>
    </div>
  );
}
```

### Phase 2: Create Sign-Up Page
Create `web/src/app/sign-up/[[...sign-up]]/page.tsx`:

```typescript
import { SignUp } from "@clerk/nextjs";

export default function SignUpPage() {
  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-50 dark:bg-gray-900 px-4">
      <div className="w-full max-w-md">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
            Create your account
          </h1>
          <p className="text-gray-600 dark:text-gray-400">
            Start provisioning ephemeral environments
          </p>
        </div>
        
        <SignUp
          appearance={{
            elements: {
              rootBox: "mx-auto",
              card: "shadow-xl",
            },
          }}
          routing="path"
          path="/sign-up"
          signInUrl="/sign-in"
        />
      </div>
    </div>
  );
}
```

### Phase 3: Add Navigation Helpers (Optional)
Create utility to redirect unauthenticated users:

```typescript
// web/src/lib/auth.ts
export function redirectToSignIn() {
  const currentUrl = window.location.pathname + window.location.search;
  const signInUrl = `/sign-in?redirect_url=${encodeURIComponent(currentUrl)}`;
  window.location.href = signInUrl;
}
```

### Phase 4: Theme Customization (Optional)
Customize Clerk appearance to match Mirage theme:

```typescript
const clerkAppearance = {
  baseTheme: undefined, // or import from @clerk/themes
  variables: {
    colorPrimary: '#your-brand-color',
    fontFamily: 'your-font-family',
  },
  elements: {
    card: 'shadow-xl rounded-lg',
    formButtonPrimary: 'bg-blue-600 hover:bg-blue-700',
    formFieldInput: 'rounded-md border-gray-300',
    footerActionLink: 'text-blue-600 hover:text-blue-700',
  },
};

<SignIn appearance={clerkAppearance} />
```

## Verification

### Page Creation Checklist
- [ ] Sign-in page created at correct path
- [ ] Sign-up page created at correct path
- [ ] Both pages use Clerk components
- [ ] Catch-all routes configured ([[...sign-in]], [[...sign-up]])

### UX Checklist
- [ ] Pages are visually appealing
- [ ] Layout is centered and responsive
- [ ] Text is readable (good contrast)
- [ ] Links between sign-in and sign-up work
- [ ] Redirects work after authentication

### Styling Checklist
- [ ] Matches Mirage's design system
- [ ] Dark mode support (if applicable)
- [ ] Mobile responsive
- [ ] Proper spacing and typography

## Test Plan

**Objective**: Verify sign-in and sign-up pages work correctly

**Test Scope**: Page rendering, Clerk component functionality, redirects

**Manual Testing Steps**:

1. **Visit Sign-In Page**:
   - Navigate to `/sign-in`
   - Verify Clerk sign-in form displays
   - Check layout and styling

2. **Sign In with Existing Account**:
   - Enter credentials
   - Submit form
   - Verify redirect to home page
   - Check authentication state

3. **Visit Sign-Up Page**:
   - Navigate to `/sign-up`
   - Verify Clerk sign-up form displays
   - Check layout and styling

4. **Create New Account**:
   - Enter email and password
   - Submit form
   - Verify email verification (if enabled)
   - Verify redirect to home page

5. **Navigate Between Pages**:
   - Click "Sign up" link from sign-in page
   - Click "Sign in" link from sign-up page
   - Verify navigation works

6. **Test Error Cases**:
   - Try signing in with wrong password
   - Try signing up with invalid email
   - Verify error messages display

7. **Test Responsive Design**:
   - View on mobile screen size
   - View on tablet screen size
   - View on desktop
   - Verify layout adapts

**Success Criteria**:
- Both pages render correctly
- Authentication flows work
- Redirects work after auth
- Error handling works
- Responsive on all screen sizes

## Files Modified

✅ **Completed:**
- `web/src/app/sign-in/[[...sign-in]]/page.tsx` - Created sign-in page with Clerk v6 SignIn component
- `web/src/app/sign-up/[[...sign-up]]/page.tsx` - Created sign-up page with Clerk v6 SignUp component

**Implementation Details:**
- Used Clerk v6 `<SignIn />` and `<SignUp />` components
- Implemented responsive, centered layout with Mirage branding
- Customized appearance using Tailwind design tokens (border, background, primary colors)
- Dark mode support via CSS variables
- Catch-all routes allow Clerk to handle multi-step flows (email verification, MFA, etc.)
- TypeScript compilation successful
- Production build successful (routes added to build output)

**Styling:**
- Uses Tailwind utility classes for layout and spacing
- Custom appearance configuration for Clerk components
- Matches existing design system with border, primary, accent colors
- Responsive design for mobile, tablet, desktop
- Clean, minimal aesthetic with clear CTAs

## Notes

### Clerk Catch-All Routes

**[[...sign-in]] Pattern**:
- Clerk handles multi-step flows (email verification, MFA, etc.)
- Catch-all route allows Clerk to manage sub-routes
- Example: `/sign-in/verify-email-address`

**Why Double Brackets**:
- `[[...slug]]` - Optional catch-all (matches `/sign-in` AND `/sign-in/anything`)
- `[...slug]` - Required catch-all (only matches `/sign-in/something`)

### Clerk Component Props

**Important Props**:
- `routing="path"` - Use Next.js routing (not hash routing)
- `path="/sign-in"` - Match the page route
- `signUpUrl="/sign-up"` - Link to sign-up page
- `appearance={{}}` - Custom styling

### Redirect Flow

**After Sign-In**:
1. User submits credentials
2. Clerk verifies credentials
3. Session created
4. Redirects to `afterSignInUrl` (default: `/`)
5. User sees authenticated app

**Custom Redirects**:
```typescript
<SignIn
  afterSignInUrl="/dashboard"  // Custom redirect
  redirectUrl="/onboarding"    // Alternative prop
/>
```

### Email Verification

**If Enabled in Clerk**:
- Sign-up requires email verification
- Clerk sends verification email
- User clicks link in email
- Redirected back to app
- Clerk handles entire flow

### Styling Considerations

**Appearance Object**:
- `baseTheme` - Use pre-built theme
- `variables` - CSS variables (colors, fonts)
- `elements` - Target specific elements with CSS classes

**Mirage Theme Colors** (adjust as needed):
- Primary: Desert/sand tones
- Accent: Mirage blue
- Background: Light/dark based on theme

### Alternative: Custom Auth Forms

**Why Use Clerk Components**:
- ✅ Faster implementation
- ✅ Security best practices built-in
- ✅ Handles edge cases (MFA, verification)
- ✅ Maintained by Clerk

**Custom Forms** (not recommended for MVP):
- More control over UX
- More implementation work
- Must handle security
- Must maintain compatibility

### Integration Dependencies

**Requires**:
- Task 16-11: ClerkProvider configured

**Enables**:
- Task 16-13: Authentication state management
- Task 16-15: Protected routes
- Users can sign up and sign in

**Testing**:
- Task 16-20: E2E tests use these pages

