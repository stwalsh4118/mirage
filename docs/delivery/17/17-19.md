# [17-19] Implement environment secrets API endpoints

[Back to task list](./tasks.md)

## Description

Create REST API endpoints for environment-specific secrets: store, retrieve, list, and delete key-value pairs scoped to environments, with bulk operations support.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-09 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |

## Requirements

1. Implement `POST /api/v1/environments/:id/secrets` - Store single secret
2. Implement `GET /api/v1/environments/:id/secrets` - List all secret keys
3. Implement `GET /api/v1/environments/:id/secrets/:key` - Get specific secret
4. Implement `DELETE /api/v1/environments/:id/secrets/:key` - Delete secret
5. Implement `POST /api/v1/environments/:id/secrets/bulk` - Bulk store
6. Verify environment ownership before operations
7. Add to SecretsController or EnvironmentController

## Implementation Plan

1. Add environment secrets methods to appropriate controller
2. Verify user owns the environment
3. Implement atomic bulk operations
4. Add validation for secret keys (no special chars, length limits)
5. Register routes

## Test Plan

**Success Criteria**:
- Store/get/delete individual secrets works
- Bulk store is atomic (all or nothing)
- Ownership verification prevents cross-user access
- Invalid environment ID returns 404
- Key validation rejects invalid keys

## Verification

- [ ] Environment secrets endpoints implemented
- [ ] Ownership verification
- [ ] Bulk operations atomic
- [ ] Key validation
- [ ] Routes registered
- [ ] Code compiles successfully

## Files Modified

- `api/internal/controller/secrets.go` or `environment.go` (updated)
- `api/internal/server/server.go` (updated)

