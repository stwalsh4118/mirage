# [17-13] Implement generic secret management with versioning

[Back to task list](./tasks.md)

## Description

Implement generic secret management with full version control: CRUD operations, version history, rollback, metadata management, and listing with filters.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-09 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |

## Requirements

1. Implement `StoreSecret` - Store generic secret with metadata
2. Implement `GetSecret` - Get secret with full metadata
3. Implement `GetSecretValue` - Get only the secret value
4. Implement `DeleteSecret` - Soft delete secret
5. Implement `ListSecrets` - List all secrets with metadata
6. Implement `GetSecretVersion` - Get specific version
7. Implement `ListSecretVersions` - List all versions
8. Implement `RollbackSecret` - Rollback to previous version
9. Implement `UpdateSecretMetadata` - Update metadata only
10. Implement `GetSecretMetadata` - Get metadata only

## Implementation Plan

1. Create `generic_secrets.go` with methods
2. Use path structure: `/mirage/users/{user_id}/custom/{key}`
3. Leverage Vault KV v2 versioning capabilities
4. Implement metadata-only operations using Vault metadata API
5. Rollback creates new version with old value
6. List operations use Vault list API
7. Add filtering support (by type, tags)
8. Integrate with caching layer

## Test Plan

**Success Criteria**:
- CRUD operations work correctly
- Versioning preserves history
- Rollback creates new version with old value
- Metadata operations don't affect secret data
- List filtering works correctly
- Keep last 10 versions as configured

## Verification

- [ ] `generic_secrets.go` created
- [ ] All CRUD methods implemented
- [ ] Version management methods implemented
- [ ] Metadata methods implemented
- [ ] List with filtering implemented
- [ ] Rollback tested
- [ ] Code compiles and matches interface

## Files Modified

- `api/internal/vault/generic_secrets.go` (new)
- `api/internal/vault/client.go` (updated)

