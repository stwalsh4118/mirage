# [17-28] Write unit tests for Vault client and SecretStore

[Back to task list](./tasks.md)

## Description

Write comprehensive unit tests for Vault client operations, SecretStore implementations, caching layer, and error handling.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-09 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |

## Requirements

1. Test client initialization with different auth methods
2. Test circuit breaker state transitions
3. Test caching (get, set, delete, expiration)
4. Test all SecretStore methods with mocked Vault
5. Test error handling for all failure scenarios
6. Test concurrent access to cache
7. Achieve >80% code coverage for vault package

## Implementation Plan

1. Create `api/internal/vault/client_test.go`
2. Create `api/internal/vault/cache_test.go`
3. Create `api/internal/vault/circuit_breaker_test.go`
4. Create test files for each secret type
5. Mock Vault API responses
6. Test happy paths and error paths
7. Test concurrent scenarios

## Test Plan

**Test Coverage:**
- Client initialization (token, AppRole)
- Authentication failures
- Circuit breaker opening/closing
- Cache hit/miss/expiration
- All CRUD operations for each secret type
- Version management
- Error conditions
- Concurrent access

**Success Criteria**:
- All tests pass
- >80% code coverage
- No race conditions detected
- Mocking properly isolates tests

## Verification

- [ ] Unit test files created
- [ ] All methods tested
- [ ] Happy paths tested
- [ ] Error paths tested
- [ ] Concurrent access tested
- [ ] Tests pass
- [ ] Coverage >80%

## Files Modified

- `api/internal/vault/*_test.go` (multiple new test files)

