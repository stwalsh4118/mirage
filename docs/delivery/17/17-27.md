# [17-27] Add database fields for Vault migration tracking

[Back to task list](./tasks.md)

## Description

Add database fields to the User model to track Vault enablement status and token validation timestamps, supporting migration tracking and health monitoring.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-09 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |

## Requirements

1. Add `VaultEnabled` boolean field to User model
2. Add `RailwayTokenLastValidated` timestamp field
3. Create database migration
4. Update User model in GORM
5. Add indexes for query performance if needed

## Implementation Plan

1. Update User model in `api/internal/store/models.go`:
   ```go
   type User struct {
       // ... existing fields ...
       VaultEnabled              bool       `gorm:"default:false"`
       RailwayTokenLastValidated *time.Time
   }
   ```

2. Create migration file

3. Run migration

4. Update SecretStore to set RailwayTokenLastValidated on validation

## Test Plan

**Success Criteria**:
- Migration runs successfully
- Fields added to database
- VaultEnabled defaults to false
- RailwayTokenLastValidated accepts null
- No data loss during migration

## Verification

- [ ] User model updated
- [ ] Migration created
- [ ] Migration tested
- [ ] Fields in database
- [ ] Default values correct
- [ ] Code compiles successfully

## Files Modified

- `api/internal/store/models.go` (updated)
- `api/migrations/` (new migration file)

