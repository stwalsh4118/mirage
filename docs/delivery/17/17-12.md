# [17-12] Implement environment-specific secrets in SecretStore

[Back to task list](./tasks.md)

## Description

Implement environment-specific secrets management: store, get, list, and delete key-value pairs scoped to specific environments, with bulk operations support.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-09 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |

## Requirements

1. Implement `StoreEnvironmentSecret` - Store single environment secret
2. Implement `GetEnvironmentSecret` - Retrieve secret with caching
3. Implement `GetAllEnvironmentSecrets` - Get all secrets for an environment
4. Implement `DeleteEnvironmentSecret` - Remove environment secret
5. Implement `BulkStoreEnvironmentSecrets` - Atomic bulk store operation
6. Use path structure: `/mirage/users/{user_id}/env_vars/{env_id}`
7. Integrate with caching layer

## Implementation Plan

1. Create `environment_secrets.go` with methods
2. Store environment secrets as map in single Vault path per environment
3. Support atomic bulk operations
4. Implement cache invalidation on updates
5. Add proper error handling and logging

## Test Plan

**Success Criteria**:
- Store/get/delete individual secrets
- Bulk store works atomically
- GetAll returns all secrets for environment
- Cache invalidation on updates
- Cross-environment isolation verified

## Verification

- [ ] `environment_secrets.go` created
- [ ] All required methods implemented
- [ ] Bulk operations work atomically
- [ ] Caching integrated
- [ ] Code compiles and matches interface

## Files Modified

- `api/internal/vault/environment_secrets.go` (new)
- `api/internal/vault/client.go` (updated)

