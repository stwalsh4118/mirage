# [17-2] Setup Docker Compose for local Vault development

[Back to task list](./tasks.md)

## Description

Add HashiCorp Vault service to the existing `docker-compose.yml` file to enable local development with Vault. Configure Vault in dev mode with in-memory storage, automatic unsealing, and a known root token for development convenience.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-09 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2025-10-09 02:00:00 | Status Change | Proposed | InProgress | Started Docker Compose configuration | AI Agent |
| 2025-10-09 02:30:00 | Status Change | InProgress | Review | Completed Vault docker-compose setup and documentation | AI Agent |

## Requirements

1. Add Vault service to `docker-compose.yml`
2. Use official `hashicorp/vault:latest` image
3. Configure dev mode with known root token
4. Expose port 8200 for HTTP API
5. Add `IPC_LOCK` capability for memory locking
6. Document environment variables in `.env.example`
7. Update README or dev docs with Vault setup instructions

## Implementation Plan

### Phase 1: Update docker-compose.yml
1. Add vault service definition with:
   - Image: `hashicorp/vault:latest`
   - Port mapping: `8200:8200`
   - Environment variables:
     - `VAULT_DEV_ROOT_TOKEN_ID=dev-root-token`
     - `VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200`
   - Capabilities: `IPC_LOCK`
   - Optional healthcheck using `vault status`

### Phase 2: Update Environment Configuration
1. Add Vault configuration to `.env.example`:
   ```
   VAULT_ADDR=http://localhost:8200
   VAULT_TOKEN=dev-root-token
   VAULT_SKIP_VERIFY=true
   VAULT_ENABLED=true
   ```
2. Document that `VAULT_SKIP_VERIFY` should only be true in development

### Phase 3: Documentation
1. Update development setup documentation:
   - How to start Vault with docker-compose
   - How to verify Vault is running
   - How to access Vault UI (http://localhost:8200/ui)
   - Default credentials for dev mode
2. Add troubleshooting section for common Vault startup issues

## Test Plan

**Objective**: Verify Vault starts successfully in dev mode and is accessible.

**Success Criteria**:
- `docker-compose up` starts Vault service without errors
- Vault is accessible at http://localhost:8200
- Vault status returns unsealed and initialized
- Vault UI accessible at http://localhost:8200/ui with dev-root-token
- API calls work with the dev token

**Test Steps**:
1. Start services: `docker-compose up -d`
2. Check Vault status: `docker-compose exec vault vault status`
3. Verify output shows `Sealed: false` and `Initialized: true`
4. Test API: `curl -H "X-Vault-Token: dev-root-token" http://localhost:8200/v1/sys/health`
5. Stop services: `docker-compose down`

## Verification

- [x] Vault service added to `docker-compose.yml`
- [x] Dev mode configured with known root token
- [x] Port 8200 exposed
- [x] IPC_LOCK capability added
- [x] Environment variables documented (in ENVIRONMENT_VARIABLES.md)
- [x] Development documentation created (VAULT_SETUP.md)
- [x] README.md updated with Vault setup instructions
- [x] Healthcheck configured for Vault service
- [x] Network configuration added for future service connectivity
- [ ] Vault starts successfully with `docker-compose up` (to be tested)
- [ ] Vault status shows unsealed and initialized (to be tested)
- [ ] Vault UI accessible (to be tested)
- [ ] API calls work with dev token (to be tested)

## Files Modified

- `docker-compose.yml` (new)
- `docs/ENVIRONMENT_VARIABLES.md` (new)
- `docs/VAULT_SETUP.md` (new)
- `README.md` (updated)

