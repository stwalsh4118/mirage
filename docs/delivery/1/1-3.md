# [1-3] Design and migrate persistence schema

[Back to task list](../tasks.md)

## Description
Design database schema and migrations for Environment, Service, and Template entities to persist state for the MVP.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-09-05 12:10:00 | Created | N/A | Proposed | Task file created | ai-agent |
| 2025-09-05 13:25:00 | Status Change | Proposed | InProgress | Started schema design and migration setup (SQLite MVP) | ai-agent |
| 2025-09-11 12:20:00 | Status Change | InProgress | Review | Added OpenFromURL with Postgres, server uses DATABASE_URL, tests passing | ai-agent |
| 2025-09-11 12:25:00 | Status Change | Review | Done | Persistence schema and config-driven DB init complete | user |

## Requirements
- Use GORM ORM with AutoMigrate for schema management (SQLite MVP, Postgres later).
- Tables for environments, services, templates with appropriate relations and indices.
- Config-driven DB init (SQLite path by default; DATABASE_URL override).

## Implementation Plan
- Add `store` package using GORM and define models (Environment, Service, Template).
- Implement DB initialization helpers and AutoMigrate on startup.
- For MVP use `gorm.io/driver/sqlite`; later add Postgres driver.

## Test Plan
- Unit test: open in-memory SQLite and AutoMigrate succeeds.
- Manual: run API, verify DB file created and tables exist.

## Verification
- Schema supports MVP queries and updates.

## Files Modified
- Store package, models, and boot wiring.
