# [1-11] Finalize Railway API integration

[Back to task list](../tasks.md)

## Description
Wire the backend to Railway Public GraphQL API v2 with real mutations/queries, add configuration for project ID, expose list endpoint for environments, and normalize statuses to match the UI model.

## Status History
| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-09-10 00:00:00 | Created | N/A | InProgress | Task created and approved | ai-agent |

## Requirements
- Add `RAILWAY_PROJECT_ID` (and optional `RAILWAY_GRAPHQL_ENDPOINT`) to config.
- Replace placeholder Railway GraphQL operations with real ones for create/destroy/get status.
- Implement `GET /environments` returning list with normalized statuses.
- Normalize Railway statuses to `active|creating|destroying|error|unknown`.
- Persist returned Railway environment ID on create.

## Implementation Plan
- Update config loading to include project ID and optional endpoint.
- Update `internal/railway/env.go` with confirmed queries/mutations.
- Update controller to use project ID and add list endpoint.
- Ensure poller normalization maps Railway states to UI states.
- Add unit/integration tests for list/create/destroy.

## Test Plan
- Controller tests for list/create/destroy with in-memory DB.
- Optional integration smoke calling Railway `viewer` when `RAILWAY_API_TOKEN` is set.

## Verification
- Run API locally with `RAILWAY_API_TOKEN` and `RAILWAY_PROJECT_ID` set; create and list environments; verify status updates.

## Files Modified
- `api/internal/config/config.go`
- `api/internal/railway/*.go`
- `api/internal/controller/environment.go`
- `api/internal/server/server.go` (if needed)
- `api/internal/jobs/status_poller.go` (status normalization)
- Tests under `api/internal/...`

