# [12-5] Build frontend Dockerfile discovery UI component

[Back to task list](./tasks.md)

## Description
Create React components to display discovered Dockerfiles in an intuitive tree view with checkboxes for service selection, metadata display, and configuration preview before deployment.

## Status History

| Timestamp | Event Type | From Status | To Status | Details | User |
|-----------|------------|-------------|-----------|---------|------|
| 2025-10-01 00:00:00 | Created | N/A | Proposed | Task file created | AI Agent |
| 2025-10-02 00:00:00 | Status Update | Proposed | InProgress | Starting UI component implementation | AI Agent |
| 2025-10-02 00:00:00 | Status Update | InProgress | Review | All components implemented with tests and documentation | AI Agent |
| 2025-10-02 00:00:00 | Status Update | Review | Done | Task approved and completed | sean |

## Requirements

1. Create TypeScript types for discovery results:
   ```typescript
   type DiscoveredService = {
     name: string;
     dockerfilePath: string;
     buildContext: string;
     exposedPorts: number[];
     buildArgs: string[];
     baseImage: string;
   };

   type DiscoveryResults = {
     services: DiscoveredService[];
   };
   ```

2. Create `DockerfileDiscoveryView` component:
   - Display discovered services in a clear list/tree structure
   - Show service name, Dockerfile path, and key metadata
   - Support selection via checkboxes
   - "Select All" / "Deselect All" functionality
   - Visual indicators (Docker icon, service type badge)

3. Create `ServiceCard` sub-component for each discovered service:
   - Service name (editable inline)
   - Dockerfile path (read-only, with copy button)
   - Build context indicator
   - Exposed ports list
   - Build arguments list (with override capability)
   - Checkbox for selection

4. Create `DiscoveryConfigPreview` component:
   - Shows what will be created before proceeding
   - List selected services with final configuration
   - Edit/override capabilities for service names

5. UI/UX considerations:
   - Empty state: "No Dockerfiles found" message
   - Loading state during scan
   - Error state with retry option
   - Smart defaults: all services selected initially
   - Responsive design

## Implementation Plan

1. Create `web/src/components/discovery/types.ts`
   - Define TypeScript interfaces matching API response

2. Create `web/src/components/discovery/ServiceCard.tsx`
   - Implement service metadata display
   - Add checkbox and name editing
   - Style with existing design system

3. Create `web/src/components/discovery/DockerfileDiscoveryView.tsx`
   - Implement main discovery results view
   - Add selection management logic
   - Implement select all/none functionality

4. Create `web/src/components/discovery/DiscoveryConfigPreview.tsx`
   - Display selected services summary
   - Show final service configurations

5. Create `web/src/hooks/useDockerfileDiscovery.ts`
   - API call to discovery endpoint
   - State management for discovery results
   - Loading and error states

6. Add Storybook stories for components (optional but recommended)

7. Write component tests using Testing Library

## Verification

- [x] TypeScript types match API response structure
- [x] `ServiceCard` displays all required metadata
- [x] Service selection toggles work correctly
- [x] Select all/none buttons work
- [x] Service names can be edited inline
- [x] Empty state displays appropriately
- [x] Loading state shows during API call
- [x] Error state shows with helpful message
- [x] Preview shows correct configuration
- [x] Components are responsive on mobile
- [x] Accessible (keyboard navigation, screen readers)

## Test Plan

### Component Tests
1. **ServiceCard rendering**:
   - Renders service name correctly
   - Displays Dockerfile path
   - Shows ports and build args
   - Checkbox toggles selection state

2. **DockerfileDiscoveryView logic**:
   - Select all button selects all services
   - Deselect all clears selection
   - Individual selection updates state correctly

3. **DiscoveryConfigPreview**:
   - Shows only selected services
   - Reflects name changes
   - Updates when selection changes

### Integration Tests
1. **Full discovery flow**:
   - Mock API returns services
   - Services display in UI
   - User selects subset
   - Preview shows correct selection
   - State is correct for next step

### Manual Testing
1. Test with varying numbers of services (1, 5, 20+)
2. Test with services with many ports/args
3. Test name editing with special characters
4. Test responsive behavior on mobile
5. Test keyboard navigation
6. Test with screen reader

## Files Modified

- `web/src/components/ui/checkbox.tsx` (new) - Added via shadcn CLI
- `web/src/components/discovery/types.ts` (new) - TypeScript type definitions for discovery API
- `web/src/components/discovery/ServiceCard.tsx` (new) - Service card component with metadata display and inline editing
- `web/src/components/discovery/DockerfileDiscoveryView.tsx` (new) - Main discovery view with search and selection management
- `web/src/components/discovery/DiscoveryConfigPreview.tsx` (new) - Preview component showing deployment configuration
- `web/src/components/discovery/index.ts` (new) - Barrel export for all discovery components
- `web/src/lib/api/discovery.ts` (new) - API client function for Dockerfile discovery endpoint
- `web/src/hooks/useDockerfileDiscovery.ts` (new) - React Query hook for discovery mutation
- `web/src/components/discovery/README.md` (new) - Documentation with usage examples and API reference
- `web/package.json` (modified) - Added @radix-ui/react-checkbox dependency via shadcn

